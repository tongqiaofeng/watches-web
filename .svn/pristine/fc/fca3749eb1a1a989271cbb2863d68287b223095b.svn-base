{"remainingRequest":"D:\\aa-tong\\my-projects\\watches-three\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\aa-tong\\my-projects\\watches-three\\src\\components\\purch\\Logistics-msg.vue?vue&type=style&index=1&lang=scss&","dependencies":[{"path":"D:\\aa-tong\\my-projects\\watches-three\\src\\components\\purch\\Logistics-msg.vue","mtime":1596447596731},{"path":"D:\\aa-tong\\my-projects\\watches-three\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\aa-tong\\my-projects\\watches-three\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\aa-tong\\my-projects\\watches-three\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\aa-tong\\my-projects\\watches-three\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\aa-tong\\my-projects\\watches-three\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\aa-tong\\my-projects\\watches-three\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKI2xvZ2lzdGljcy1tc2cgewogIC5lbC1pbnB1dF9fc3VmZml4IHsKICAgIHdpZHRoOiAzMCU7CiAgfQp9Cg=="},{"version":3,"sources":["Logistics-msg.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwfA;AACA;AACA;AACA;AACA","file":"Logistics-msg.vue","sourceRoot":"src/components/purch","sourcesContent":["<template>\r\n  <div class=\"msg-container\" id=\"logistics-msg\">\r\n    <!-- <h1>商品发货</h1> -->\r\n    <div class=\"back-button\" @click=\"selecting\">\r\n      <div>\r\n        <img src=\"../../assets/imgs/goback.png\" />\r\n      </div>\r\n      <span>继续选择</span>\r\n    </div>\r\n    <div class=\"msg-info-first\">\r\n      <el-form label-width=\"150px\">\r\n        <el-form-item label=\"发货时间：\">\r\n          <el-date-picker class=\"input-style\" v-model=\"log_sendTime\" type=\"date\" placeholder=\"date\"></el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item label=\"预计到达时间：\">\r\n          <el-date-picker class=\"input-style\" v-model=\"arriveTime\" type=\"date\"></el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item label=\"到达仓库：\">\r\n          <el-select v-model=\"warehouse\" placeholder=\"请选择\" class=\"input-style\">\r\n            <el-option v-for=\"(item,index) in warehouseList\" :key=\"index\" :label=\"item.name\" :value=\"item.name\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n    <div class=\"msg-freight\">\r\n      <el-form label-width=\"150px\">\r\n        <el-form-item label=\"运费：\">\r\n          <el-input v-model=\"freight\" @input=\"freightChange\" style=\"width: 50%;height: auto;line-height: 40px;\">\r\n            <i slot=\"suffix\" style=\"color: #000;margin-right:5%;font-style:normal;\">HKD</i>\r\n          </el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div class=\"freight-container\">\r\n        <p>每块表分摊金额：</p>\r\n        <table>\r\n          <tr>\r\n            <th>图片</th>\r\n            <th>型号</th>\r\n            <th>机芯号</th>\r\n            <th>采购价</th>\r\n            <th>\r\n              <span style=\"width: 75%;margin: 0 auto;\">运费</span>\r\n            </th>\r\n          </tr>\r\n          <tr v-for=\"(item,index) in watchFreightList\" :key=\"index\">\r\n            <td>\r\n              <img v-image-preview\r\n                :src=\"item.buy_watchPics == null || item.buy_watchPics == '' ? '' : img + '/img/watch/'+ (item.buy_watchPics || '').split('|')[0]\"\r\n                style=\"width: 100px;height: 100px;object-fit: cover;border-radius: 30px;\" />\r\n            </td>\r\n            <td>\r\n              <div>\r\n                <span>{{item.buy_watchBrand}}</span>\r\n              </div>\r\n              <div>\r\n                <span>{{item.buy_watchModel}}</span>\r\n              </div>\r\n            </td>\r\n            <td>{{item.buy_watchSn}}</td>\r\n            <td>{{item.buy_watchCurrency}} {{formatNumberRgx(item.buy_watchPrice)}}</td>\r\n            <td>\r\n              <div style=\"width: 75%;margin: 0 auto;padding-left: 5px;border-bottom: 1px solid #000;display: flex;\">\r\n                <input type=\"text\" v-model=\"arries[index]\" class=\"freight-input\" @input=\"inputChange\" />\r\n                <i slot=\"suffix\" style=\"color: #000;margin-right:5%;font-style:normal;\">HKD</i>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </div>\r\n    </div>\r\n    <div class=\"sure\">\r\n      <input class=\"sure-button\" type=\"button\" value=\"确认\" @click=\"msgSubmit\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        log_sendTime: new Date(),\r\n        img: this.$store.state.baseUrl,\r\n        arriveTime: \"\",\r\n        warehouseList: [],\r\n        warehouse: \"\",\r\n        warehouseId: 1,\r\n        freight: \"\", // 运费\r\n        watchFreightList: \"\",\r\n        arries: [],\r\n        log_watch: [],\r\n        x: 0,\r\n        sum: 0,\r\n        sum2: 0,\r\n        sum3: 0,\r\n        sum4: 0,\r\n        id: 0,\r\n        log_moneyEx: 0, // 每块表分摊金额\r\n        mathes1: 0,\r\n        mathes2: 0,\r\n        rateArr: [], // 汇率\r\n        price: 0,\r\n        as: 0,\r\n      };\r\n    },\r\n    created() {\r\n      this.handleWarehouse();\r\n      console.log(\"999\");\r\n      // 要发货的手表列表\r\n      this.watchFreightList = JSON.parse(sessionStorage.getItem(\"isSelected\"));\r\n      console.log(this.watchFreightList);\r\n    },\r\n    methods: {\r\n      // 获得仓库列表\r\n      handleWarehouse() {\r\n        this.$axios\r\n          .post(this.$store.state.baseUrl + \"/WarehouseGet\")\r\n          .then(res => {\r\n            console.log(\"desf\");\r\n            console.log(res);\r\n            this.warehouseList = res.data;\r\n          })\r\n          .catch(err => {\r\n            console.log(err);\r\n          });\r\n      },\r\n      // 计算运费\r\n      freightChange() {\r\n        this.$axios\r\n          .post(this.$store.state.baseUrl + \"/RatesGet\", {\r\n            // source: item.buy_watchcurrency\r\n            source: \"CNY\"\r\n          })\r\n          .then(res => {\r\n            console.log(\"汇率计算\");\r\n            console.log(res);\r\n            this.rateArr = res.data;\r\n            for (let arr of this.watchFreightList) {\r\n              this.sum += arr.buy_watchprice;\r\n            }\r\n            if (this.freight == 0) {\r\n              this.arries = [];\r\n              for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                this.arries.splice(i, 1, 0);\r\n              }\r\n            } else {\r\n              if (this.watchFreightList.length == 1) {\r\n                this.arries = [];\r\n                console.log(\"ffff\");\r\n                this.arries.push(this.freight);\r\n                console.log(this.arries);\r\n              }\r\n              if (this.watchFreightList.length == 2) {\r\n                this.arries = [];\r\n                this.mathes1 = 0;\r\n                this.sum2 = 0;\r\n                console.log(\"dddddddd\");\r\n                console.log(this.arries);\r\n                for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                  if (this.watchFreightList[i].buy_watchcurrency == 'CNY') {\r\n                    this.sum2 += Number(this.watchFreightList[i].buy_watchprice);\r\n                    console.log('7777755555---' + this.watchFreightList[i].buy_watchprice);\r\n                  }\r\n                }\r\n                for (let items of this.rateArr) {\r\n                  for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                    if (this.watchFreightList[i].buy_watchcurrency !== 'CNY') {\r\n                      if (items.type == 0) {\r\n                        if (items.dest === this.watchFreightList[i].buy_watchcurrency) {\r\n                          console.log('价格' + this.watchFreightList[i].buy_watchprice);\r\n                          console.log('汇率' + items.rate);\r\n                          this.sum2 += Number(this.watchFreightList[i].buy_watchprice) * Number(items.rate);\r\n                          console.log('ggggggggggggg----' + this.sum2);\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                console.log('999999999777777777---' + this.sum2);\r\n                for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                  this.arries.push(i);\r\n                }\r\n                console.log('数据');\r\n                console.log(this.arries);\r\n                for (let ite of this.rateArr) {\r\n                  console.log('sum2---' + this.sum2);\r\n                  for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                    if (this.watchFreightList[i].buy_watchcurrency == 'CNY') {\r\n                      this.mathes1 = Number(Number(this.watchFreightList[i].buy_watchprice) / this.sum2 * this\r\n                        .freight);\r\n                      this.mathes1 = this.mathes1.toFixed(0);\r\n                      // this.arries.push(this.mathes1);\r\n                      this.arries.splice(i, 1, this.mathes1);\r\n                      console.log(i + '位置' + this.watchFreightList[i].buy_watchprice + '计算--' + this.mathes2);\r\n                      console.log(this.arries);\r\n                    } else if (this.watchFreightList[i].buy_watchcurrency !== 'CNY') {\r\n                      if (ite.type == 0) {\r\n                        if (ite.dest == this.watchFreightList[i].buy_watchcurrency) {\r\n                          console.log('====-----' + ite.dest + '---' + ite.rate);\r\n                          this.mathes1 = Number(Number(this.watchFreightList[i].buy_watchprice) * Number(ite.rate) /\r\n                            this.sum2 * this.freight);\r\n                          this.mathes1 = this.mathes1.toFixed(0);\r\n                          // this.arries.push(this.mathes1);\r\n                          this.arries.splice(i, 1, this.mathes1);\r\n                          console.log(i + '位置' + this.watchFreightList[i].buy_watchprice + '计算--' + this.mathes2);\r\n                          console.log(this.arries);\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n              if (this.watchFreightList.length > 2) {\r\n                this.arries = [];\r\n                this.mathes2 = 0;\r\n                this.sum2 = 0;\r\n                for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                  if (this.watchFreightList[i].buy_watchcurrency == 'CNY') {\r\n                    this.sum2 += Number(this.watchFreightList[i].buy_watchprice);\r\n                    console.log('7777755555---' + this.watchFreightList[i].buy_watchprice);\r\n                  }\r\n                }\r\n                for (let items of this.rateArr) {\r\n                  for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                    if (this.watchFreightList[i].buy_watchcurrency !== 'CNY') {\r\n                      if (items.type == 0) {\r\n                        if (items.dest === this.watchFreightList[i].buy_watchcurrency) {\r\n                          console.log('价格' + this.watchFreightList[i].buy_watchprice);\r\n                          console.log('汇率' + items.rate);\r\n                          this.sum2 += Number(Number(this.watchFreightList[i].buy_watchprice) * Number(items.rate));\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                  console.log('999999999999---' + this.sum2);\r\n                }\r\n                console.log(this.watchFreightList);\r\n                for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                  this.arries.push(i);\r\n                }\r\n                console.log('数据');\r\n                console.log(this.arries);\r\n                for (let items of this.rateArr) {\r\n                  for (let i = 0; i < this.watchFreightList.length; i++) {\r\n                    if (this.watchFreightList[i].buy_watchcurrency == 'CNY') {\r\n                      this.mathes2 = Number(Number(this.watchFreightList[i].buy_watchprice) / Number(this.sum2) *\r\n                        Number(this.freight));\r\n                      this.arries.splice(i, 1, this.mathes2.toFixed(0));\r\n                      console.log(i + '位置' + this.watchFreightList[i].buy_watchprice + '计算--' + this.mathes2);\r\n                    } else if (this.watchFreightList[i].buy_watchcurrency !== 'CNY') {\r\n                      if (items.type == 0) {\r\n                        if (items.dest == this.watchFreightList[i].buy_watchcurrency) {\r\n                          this.mathes2 = Number(Number(this.watchFreightList[i].buy_watchprice) * Number(items.rate) /\r\n                            Number(this.sum2) * Number(this.freight));\r\n                          // this.arries.push(this.mathes2.toFixed(0));\r\n                          this.arries.splice(i, 1, this.mathes2.toFixed(0));\r\n                          console.log(i + '位置' + this.watchFreightList[i].buy_watchprice + '计算--' + this.mathes2);\r\n                          console.log(this.arries);\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n\r\n          });\r\n      },\r\n      // 继续选择要发货的商品\r\n      selecting() {\r\n        this.$emit(\"selecting\", 0);\r\n      },\r\n      // 发货前确认运费\r\n      verification() {\r\n        this.sum3 = 0;\r\n        for (let item of this.arries) {\r\n          this.sum3 += Number(item);\r\n        }\r\n        console.log('打印运费');\r\n        console.log(this.arries);\r\n        console.log(this.sum3, this.freight);\r\n        if (this.sum3 !== Number(this.freight)) {\r\n          this.$message.error({\r\n            message: \"各表分摊运费的和与总运费不一致，请重新计算填写\",\r\n            showClose: true,\r\n            duration: 2000\r\n          })\r\n          return 1;\r\n        }\r\n        if (\r\n          this.log_sendTime == null ||\r\n          this.arriveTime == null ||\r\n          this.warehouse == \"\" ||\r\n          this.freight == \"\"\r\n        ) {\r\n          this.$message.error({\r\n            message: \"数据不能为空，请检查数据填写\",\r\n            showClose: true,\r\n            duration: 2000\r\n          })\r\n          return 1;\r\n        }\r\n      },\r\n      submit() {\r\n        for (let item of this.warehouseList) {\r\n          if (item.name == this.warehouse) {\r\n            this.warehouseId = item.id;\r\n          }\r\n        }\r\n        // console.log(this.warehouseId);\r\n        let watchOne = {\r\n          id: 0\r\n        };\r\n        for (let index in this.watchFreightList) {\r\n          let watchOne = {\r\n            id: 0,\r\n            log_moneyEx: 0\r\n          };\r\n          watchOne.id = this.watchFreightList[index].id;\r\n          watchOne.log_moneyEx = this.arries[index];\r\n          this.log_watch.push(watchOne);\r\n        }\r\n        // console.log('pppp');\r\n        // console.log(this.log_watch);\r\n        const loading = this.$loading({\r\n          lock: true,\r\n          text: '数据提交中...',\r\n          spinner: 'el-icon-loading',\r\n          background: 'rgba(0, 0, 0, 0.7)'\r\n        });\r\n        this.$axios\r\n          .post(this.$store.state.baseUrl + \"/LOGInsert\", {\r\n            log_sendTime: this.shellDate(this.log_sendTime),\r\n            log_arriveTime: this.shellDate(this.arriveTime),\r\n            log_warehouseId: this.warehouseId,\r\n            log_warehouse: this.warehouse,\r\n            log_money: this.freight,\r\n            log_watch: this.log_watch\r\n          })\r\n          .then(res => {\r\n            console.log(\"本次商品发货成功\");\r\n            loading.close();\r\n            this.$emit(\r\n              \"logisticsMsg\",\r\n              \"我是物流信息填写页面发过来的数据，请接收\"\r\n            );\r\n            console.log(res);\r\n            this.$message.success({\r\n              message: \"本次物流信息提交成功\",\r\n              showClose: true,\r\n              duration: 2000\r\n            });\r\n            this.$emit(\"selecting\", 0);\r\n            sessionStorage.setItem(\"isSelected\", []);\r\n            // 页面回到顶部\r\n            (function smoothscroll() {\r\n              var currentScroll =\r\n                document.documentElement.scrollTop || document.body.scrollTop;\r\n              if (currentScroll > 0) {\r\n                window.requestAnimationFrame(smoothscroll);\r\n                window.scrollTo(0, currentScroll - currentScroll / 5);\r\n              }\r\n            })();\r\n          })\r\n          .catch(err => {\r\n            console.log(err);\r\n            loading.close();\r\n            this.$message.error({\r\n              message: err.data.message,\r\n              showClose: true,\r\n              duration: 2000\r\n            });\r\n          });\r\n      },\r\n      // 确认发货\r\n      msgSubmit() {\r\n        if (this.verification() !== 1) {\r\n          this.submit();\r\n        }\r\n      },\r\n      // 运费变化\r\n      inputChange() {\r\n        this.freight = 0;\r\n        for (let item of this.arries) {\r\n          console.log(item);\r\n          if (item % 1 === 0) {\r\n            this.freight += Number(item);\r\n          } else {\r\n            this.$message.error({\r\n              message: '数据不能包含小数，请重新输入',\r\n              showClose: true,\r\n              duration: 2000\r\n            })\r\n          }\r\n        }\r\n      },\r\n    }\r\n  };\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n  .msg-container {\r\n    width: 100%;\r\n    margin: 0 auto;\r\n\r\n    .back-button {\r\n      width: 105px;\r\n      height: 30px;\r\n      margin-bottom: 20px;\r\n      line-height: 37px;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      cursor: pointer;\r\n\r\n      div {\r\n        margin-top: 5px;\r\n\r\n        img {\r\n          width: 30px;\r\n          height: 25px;\r\n        }\r\n      }\r\n\r\n      .font {\r\n        font-size: 17px;\r\n      }\r\n    }\r\n\r\n    .msg-info-first,\r\n    .msg-freight {\r\n      width: 100%;\r\n      padding: 40px 0;\r\n      padding-bottom: 20px;\r\n      // padding-left: 20px;\r\n      background-color: #fff;\r\n      border-radius: 30px;\r\n    }\r\n\r\n    .input-style {\r\n      width: 50%;\r\n    }\r\n\r\n    .msg-freight {\r\n      margin: 20px 0;\r\n\r\n      .freight-container {\r\n        width: 90%;\r\n        margin: 0 auto;\r\n        margin-top: 40px;\r\n        padding: 30px;\r\n        border: 1px solid #ddd;\r\n        border-radius: 30px;\r\n\r\n        td {\r\n          padding: 20px 0;\r\n          background-color: #f3fbf9;\r\n          font-size: 15px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .freight-input {\r\n      width: 80%;\r\n      height: 40px;\r\n      border: 0;\r\n      outline: none;\r\n      background-color: transparent;\r\n    }\r\n\r\n    .sure {\r\n      width: 95%;\r\n      margin: 20px;\r\n      text-align: right;\r\n\r\n      .sure-button {\r\n        width: 300px;\r\n        height: 50px;\r\n        background-color: #0c8563;\r\n        color: #fff;\r\n        border: 0;\r\n        border-radius: 30px;\r\n        outline: none;\r\n        font-size: 16px;\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  }\r\n\r\n  table {\r\n    width: 100%;\r\n    table-layout: fixed;\r\n    border-collapse: separate;\r\n    border-spacing: 0;\r\n\r\n    tr {\r\n\r\n      th,\r\n      td {\r\n        width: 21%;\r\n        text-align: center;\r\n        border: 0;\r\n      }\r\n    }\r\n  }\r\n</style>\r\n<style lang=\"scss\">\r\n  #logistics-msg {\r\n    .el-input__suffix {\r\n      width: 30%;\r\n    }\r\n  }\r\n</style>"]}]}